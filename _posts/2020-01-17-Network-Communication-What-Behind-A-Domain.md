---
layout: post
title: 网络通信基础（三）浏览器输入网址背后发生了什么
tags: 网络通信基础  

---

# 问题：当我们输入一个域名后，发生了什么
当我们在浏览器输入一个域名，按下回车键之后，到我们能够看到页面，这个过程中，到底发生了什么事情，下面我们开始一步步分析。

# DNS 域名解析
`DNS` 域名解析主要可以分为三个过程
1. 读缓存
    浏览器会把已经解析过的域名缓存起来，如果缓存中存在，解析结束。缓存的时效性可以通过TTL属性设置
2. 读本地Host文件
    如果缓存中没有该域名，Windows系统会读取本地的Host文件（这也是我们最常用的修改域名映射地址的方法）
3. 请求域名服务器
    请求域名服务器这个过程就需要联系前面学过的`HTTP`通信协议了，这个过程就是通过`HTTP`协议实现主机和域名服务器的交互的，具体的交互过程如下图!（图片来源：[解DNS域名解析全过程](https://blog.csdn.net/m0_37812513/article/details/78775629)

![](/images/posts/myBlog/2020-01-17-Network-Communication-What-Behind-A-Domain-01.png)

    1. 请求本地域名服务器（LDNS）来解析这个域名，这台服务器一般都在所在城市附近，同样会缓存其域名解析结果，大约80%的域名解析到这里就完成了。
    2. 如果LDNS没有该域名映射，则请求根域名服务器（`Root Server`） 请求解析
    3. 根域名服务器返回给LDNS一个所查询域的主域名服务器（gTLD Server，国际顶尖域名服务器，如.com .cn .org等）地址
    4. 此时LDNS再请求gTLD域名服务器解析需要解析的域名
    5. gTLD域名服务器返回这个域名对应的`Name Server`的地址，这个`Name Server`就是网站注册的域名服务器
    6. Name Server根据映射关系表找到目标ip，返回给LDNS
    7. LDNS缓存这个域名和对应的ip
    8. LDNS把解析的结果返回

# 发送数据包
上面的步骤解析完域名之后，就拿到了域名对应的ip地址，根据前面 [HTTP（TCP/IP）通信协议](wangzhi) 我们知道，浏览器是在应用层的，接下来就是往下逐层加上对应的协议头，具体过程不再累述。这里重点讲一下其寻址过程。

## 数据包发送的寻址过程
结合前面的知识，我们已经知道了，数据帧的组成应该如下图所示：


